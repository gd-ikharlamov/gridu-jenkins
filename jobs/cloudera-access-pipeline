#!/usr/bin/env groovy

node {

    git_repo = "https://github.com/gd-ikharlamov/gridu-jenkins.git"

    // try {
    //
    //     notifyBuild('STARTED')


        stage('Pull repository') {
            git git_repo
        }

        stage('Create credentials') {

            dir ('ansible') {
                sshagent(['3c748d77-a9bd-415e-969b-d97be760769a']) {
                    ansiblePlaybook credentialsId: '',
                                    extras: "-b --become-user=centos -e user_name=${user_name} -e user_email=${user_email}",
                                    playbook: 'add-user.yml',
                                    sudo: false,
                                    vaultCredentialsId: '06ee78b8-2e44-4741-9c60-6ecf7b052f96'
                }

            }
        }

        stage('Cleanup'){
            deleteDir()
        }

//         } catch (e) {
//             // If there was an exception thrown, the build failed
//             currentBuild.result = "FAILED"
//             throw e
//
//         } finally {
//             // Success or failure, always send notifications
//             notifyBuild(currentBuild.result)
//         }
//
// }
//
// def notifyBuild(String buildStatus = 'STARTED') {
//     // build status of null means successful
//     buildStatus =  buildStatus ?: 'SUCCESSFUL'
//
//     // Default values
//     def colorName = 'RED'
//     def colorCode = '#FF0000'
//     def subject = "${buildStatus}: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]'"
//     def summary = "${subject} (${env.BUILD_URL})"
//     def details = """<p>STARTED: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]':</p>
//     <p>Check console output at "<a href="${env.BUILD_URL}">${env.JOB_NAME} [${env.BUILD_NUMBER}]</a>"</p>"""
//
//     // Override default values based on build status
//     if (buildStatus == 'STARTED') {
//         color = 'YELLOW'
//         colorCode = '#FFFF00'
//     } else if (buildStatus == 'SUCCESSFUL') {
//         color = 'GREEN'
//         colorCode = '#00FF00'
//     } else {
//         color = 'RED'
//         colorCode = '#FF0000'
//     }
//
//     // Send notifications
//     slackSend (color: colorCode, message: summary)
//
}
